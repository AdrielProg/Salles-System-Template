@model SallesApp.ViewModel.Login.ChangePasswordViewModel
@{
    ViewData["Title"] = "Mudar Senha";
}

<h2>@ViewData["Title"]</h2>

<!-- Formulário para verificar o email -->
<form id="checkEmailForm" method="post" role="form">
    <div class="form-group">
        <label asp-for="Email"></label>
        <input asp-for="Email" class="form-control" id="emailInput" />
        <span asp-validation-for="Email" class="text-danger"></span>
        <button type="button" id="checkEmailButton" class="btn btn-secondary">Verificar Email</button>
    </div>
</form>

<!-- Formulário para mudar a senha -->
<form id="changePasswordForm" asp-controller="Account" asp-action="ChangePassword" method="post" role="form" style="display:none;">
    <div class="form-group">
        <label asp-for="NewPassword"></label>
        <input asp-for="NewPassword" class="form-control" />
        <span asp-validation-for="NewPassword" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="ConfirmPassword"></label>
        <input asp-for="ConfirmPassword" class="form-control" />
        <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
    </div>
    <input type="submit" class="btn btn-primary" value="Mudar Senha" />
</form>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
@section Scripts {
    <script>
        $(document).ready(function() {
            $('#checkEmailButton').on('click', function() {
                var email = $('#emailInput').val();
                $.ajax({
                    url: '@Url.Action("CheckEmailExists", "Account")',
                    type: 'POST',
                    data: { email: email },
                    success: function(response) {
                        if (response) {
                            $('#changePasswordForm').show();
                        } else {
                            $('#changePasswordForm').hide();
                            alert('Email não encontrado.');
                        }
                    }
                });
            });
        });
    </script>
}